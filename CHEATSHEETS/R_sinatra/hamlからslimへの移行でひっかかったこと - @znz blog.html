<!DOCTYPE html> <html ⚡ lang="ja"> <head> <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,700|Lora:400,700' rel='stylesheet' type='text/css'> <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script> <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script><script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script><script async custom-element="amp-geo" src="https://cdn.ampproject.org/v0/amp-geo-0.1.js"></script> <script async custom-element="amp-consent" src="https://cdn.ampproject.org/v0/amp-consent-0.1.js"></script> <script async custom-element="amp-ad" src="https://cdn.ampproject.org/v0/amp-ad-0.1.js"></script> <script async custom-element="amp-auto-ads" src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js"> </script><script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"></script> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width,minimum-scale=1"><title>hamlからslimへの移行でひっかかったこと - @znz blog</title> <meta name="description" content="haml より slim の方が速いらしいという話を良く見かけるので、haml から少しずつ slim に移行しようとして、haml2slim で変換してみたらひっかかりまくりました。"> <link rel="canonical" href="https://blog.n-z.jp/blog/2014-03-11-haml-to-slim.html"> <link rel="alternate" type="application/rss+xml" title="@znz blog" href="https://blog.n-z.jp/feed.xml"> <link href="/assets/images/znz.png" rel="icon"> <script type="application/ld+json">
  
{
  "@context": "http://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage": "https://blog.n-z.jp/blog/2014-03-11-haml-to-slim.html",
  "headline": "hamlからslimへの移行でひっかかったこと",
  "datePublished": "2014-03-11T13:39:11+00:00",
  "dateModified": "2018-03-03T10:14:08+00:00",
  "description": "haml より slim の方が速いらしいという話を良く見かけるので、haml から少しずつ slim に移行しようとして、haml2slim で変換してみたらひっかかりまくりました。",
  "author": {
    "@type": "Person",
    "name": "Kazuhiro NISHIYAMA"
  },
  "publisher": {
    "@type": "Organization",
    "name": "@znz blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blog.n-z.jp/assets/images/znz.png",
      "width": "60",
      "height": "60"
    }
  },
  "image": {
    "@type": "ImageObject",
    "url": "https://blog.n-z.jp/assets/images/znz.png",
    "height": "60",
    "width": "60"
  }
}

  </script> <link href="https://use.fontawesome.com/releases/v5.0.9/css/all.css" rel="stylesheet"> <style amp-custom>.highlight{background:#fff}.highlighter-rouge .highlight{background:#eef}.highlight .c{color:#998;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{font-weight:bold}.highlight .o{font-weight:bold}.highlight .cm{color:#998;font-style:italic}.highlight .cp{color:#999;font-weight:bold}.highlight .c1{color:#998;font-style:italic}.highlight .cs{color:#999;font-weight:bold;font-style:italic}.highlight .gd{color:#000;background-color:#fdd}.highlight .gd .x{color:#000;background-color:#faa}.highlight .ge{font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000;background-color:#dfd}.highlight .gi .x{color:#000;background-color:#afa}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kc{font-weight:bold}.highlight .kd{font-weight:bold}.highlight .kp{font-weight:bold}.highlight .kr{font-weight:bold}.highlight .kt{color:#458;font-weight:bold}.highlight .m{color:#099}.highlight .s{color:#d14}.highlight .na{color:#008080}.highlight .nb{color:#0086b3}.highlight .nc{color:#458;font-weight:bold}.highlight .no{color:#008080}.highlight .ni{color:#800080}.highlight .ne{color:#900;font-weight:bold}.highlight .nf{color:#900;font-weight:bold}.highlight .nn{color:#555}.highlight .nt{color:#000080}.highlight .nv{color:#008080}.highlight .ow{font-weight:bold}.highlight .w{color:#bbb}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .sb{color:#d14}.highlight .sc{color:#d14}.highlight .sd{color:#d14}.highlight .s2{color:#d14}.highlight .se{color:#d14}.highlight .sh{color:#d14}.highlight .si{color:#d14}.highlight .sx{color:#d14}.highlight .sr{color:#009926}.highlight .s1{color:#d14}.highlight .ss{color:#990073}.highlight .bp{color:#999}.highlight .vc{color:#008080}.highlight .vg{color:#008080}.highlight .vi{color:#008080}.highlight .il{color:#099}.icon>svg{display:inline-block;width:16px;height:16px;vertical-align:middle}.icon>svg path{fill:#828282}amp-img{background-color:grey}.cf:after{content:"";display:table;clear:both}main{display:block}body{background-color:#fff;font-family:"Helvetica Neue","Open Sans",Arial,Helvetica,sans-serif;margin:0;padding:0;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-font-feature-settings:"liga=1, dlig=1";-ms-font-feature-settings:"liga","dlig";-webkit-font-feature-settings:"liga","dlig";-o-font-feature-settings:"liga","dlig";font-feature-settings:"liga","dlig"}.site-header{position:relative;width:100%;max-width:700px;margin:16px auto 0 auto;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}@media only screen and (max-width:800px){.site-header{padding:0 16px}}.site-header .page-links{display:block;position:absolute;top:10px;right:16px;font-weight:200;font-style:normal;font-size:18px;line-height:30px}.site-header .page-links a{text-decoration:none;color:#999}.site-header .page-links a:hover{color:#333}.blog-header{width:100%;max-width:700px;margin:0 auto;position:relative;padding:0;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.blog-header .blog-title{margin-bottom:8px;font-size:50px;font-weight:700;letter-spacing:-2px;outline:0;line-height:50px;word-break:break-word;color:#333}.blog-header .blog-description{font-size:28px;margin:0 0 20px;padding:0;line-height:1.2;color:#666;font-weight:300}.content{width:100%;max-width:700px;margin:25px auto 0 auto;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}@media only screen and (max-width:800px){.content{padding:0 16px}}.content article{padding:20px 0;border-bottom:1px solid #f2f2f0}.content article:last-child{border-bottom:0}.content article .post-title{letter-spacing:-0.02em;font-weight:700;font-style:normal;display:block;font-size:36px;line-height:1.15;margin:0}.content article .post-title a{text-decoration:none;color:#333332}.content article .post-title a:hover{text-decoration:none}.content article .post-excerpt{letter-spacing:-0.02em;font-weight:300;font-style:normal;font-size:20px;line-height:1.59;color:#666665}.content article .post-meta{font-size:14px;color:#b3b3b1;line-height:30px}.content article .post-meta a{color:#b3b3b1;text-decoration:none}.content article .post-meta a:hover{text-decoration:underline}.post-template .content{max-width:700px}.index-headline{border-top:1px solid #dededc;margin:0;padding:16px 0}.index-headline span{color:#b3b3b1;font-size:10px;text-transform:uppercase;letter-spacing:1px}.pagination{text-align:center;padding:16px 0 0;font-size:12px}.pagination a{color:#999;text-decoration:none}
.pagination a:hover{color:#333}.site-footer{margin:0 auto;padding:48px 0;width:100%;max-width:700px;font-size:12px;text-align:center;color:#999;line-height:17.6px}.site-footer a{color:#666;text-decoration:none}.site-footer a:hover{color:#333}.post .post-meta{font-family:"Helvetica Neue","Open Sans",Arial,Helvetica,sans-serif}.post .post-title{font-weight:700;font-style:normal;letter-spacing:-0.04em;font-size:50px;line-height:1.1;color:#333332;margin-bottom:50px}.post .author-image{background-image:url(/assets/images/znz.png);display:inline-block;width:30px;height:30px;line-height:30px;margin-right:8px;margin-bottom:-10px;float:left;background-size:cover;border-radius:100%;text-indent:-9999px}.post .post-meta-text{color:#b3b3b1;letter-spacing:-0.02em;font-weight:400;font-style:normal;font-size:14px;overflow:hidden;font-family:"Helvetica Neue","Open Sans",Arial,Helvetica,sans-serif;white-space:nowrap;text-overflow:ellipsis}.post .post-content{width:100%;font-family:Georgia,Cambria,"Times New Roman",Times,"Lora",serif;color:#333}.post .post-content h1,.post .post-content h2,.post .post-content h3{font-family:"Helvetica Neue","Open Sans",Arial,Helvetica,sans-serif}.post .post-content h3,.post .post-content h4,.post .post-content h5,.post .post-content h6{letter-spacing:-0.02em;font-weight:700;font-style:normal;font-size:24px;line-height:1.3;margin-top:50px;margin-bottom:0;font-family:"Helvetica Neue","Open Sans",Arial,Helvetica,sans-serif}.post .post-content h3{font-size:36px}.post .post-content h2,.post .post-content h1{letter-spacing:-0.02em;font-weight:700;font-style:normal;font-size:42px;line-height:1.2;margin-top:50px;margin-bottom:0}.post .post-content table{border-collapse:collapse}.post .post-content table,.post .post-content th,.post .post-content td{border:1px solid black;padding:5px;text-align:left}.post .post-content p{font-weight:400;font-style:normal;font-size:22px;line-height:1.59;letter-spacing:-.002em;margin-top:30px;margin-bottom:0;color:#333;-webkit-hyphens:auto;-moz-hyphens:auto;hyphens:auto}.post .post-content a{color:#333;text-decoration:underline}.post .post-content amp-img,.post .post-content amp-youtube{margin-top:30px}.post .post-content figure{margin:0;padding:0 0 30px}.post .post-content figcaption{font-weight:400;font-style:italic;font-size:16px;line-height:1.3;color:#666665;outline:0;z-index:300;text-align:center}.post .post-content hr{border:0;padding:0;display:block;width:15%;margin:30px auto;border:0 solid #ddd;border-top:1px solid #ddd}.post .post-content blockquote{margin:0 0 30px;margin-left:-26px;border-left:3px solid #57ad68;padding-left:20px}.post .post-content blockquote p{letter-spacing:.01rem;font-weight:400;mborder-left:3px solid #57ad68;mpadding-left:20px;mmargin-left:-26px;padding-bottom:3px}.post .post-content ul,.post .post-content ol{padding:0 0 30px;margin:0}.post .post-content li{padding:0;font-weight:400;font-style:normal;font-size:23px;line-height:30px;margin-left:30px;margin-bottom:12px;padding-top:2px}.post .post-content li p{padding:0 0 1.618rem}.post .post-content ol li{list-style-type:decimal}.post .bottom-teaser{padding:50px 0 0 0;font-family:"Helvetica Neue","Open Sans",Arial,Helvetica,sans-serif}.post .bottom-teaser hr{border:0;padding:0;display:block;width:15%;margin:16px 0 16px 100px;border:0 solid #ddd;border-top:1px solid #ddd}.post .bottom-teaser .isLeft{float:left;width:47%;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}@media only screen and (max-width:800px){.post .bottom-teaser .isLeft{width:100%;padding-bottom:32px}}.post .bottom-teaser .isLeft .bio{margin-top:18px;margin-bottom:18px}.post .bottom-teaser .isLeft .username{margin-left:4px;margin-right:18px;margin-bottom:18px}.post .bottom-teaser .isLeft .index-headline{padding-bottom:32px}.post .bottom-teaser .isLeft a{color:black;text-decoration:none}.post .bottom-teaser .isLeft a:hover{color:#333;text-decoration:underline}.post .bottom-teaser .isLeft .author-image{display:block;width:80px;height:80px;float:left;background-size:cover;border-radius:100%;text-indent:-9999px}.post .bottom-teaser .isLeft h4{font-size:18px;line-height:1.1;font-weight:700;padding:0;margin:0;padding-left:100px}.post .bottom-teaser .isLeft p{font-size:14px;line-height:1.3;font-weight:400;padding:0;margin:0;padding-left:100px}.post .bottom-teaser .isLeft p.published{color:#999}.post .bottom-teaser .isRight{float:right;width:47%;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}@media only screen and (max-width:800px){.post .bottom-teaser .isRight{width:100%}}.post .bottom-teaser .isRight .index-headline{padding-bottom:32px}.post .bottom-teaser .isRight .site-footer{margin:0;padding:0;color:#333;text-align:left;font-size:14px;line-height:1.3;color:#999}
.post .bottom-teaser .isRight .site-footer a{color:#333;text-decoration:none}.post .bottom-teaser .isRight .site-footer a:hover{text-decoration:underline}.post .bottom-teaser .isRight .site-footer .poweredby{display:block;padding-bottom:18px;font-weight:700;color:#333}.share{text-align:right;padding:20px 0 0}.share a{text-decoration:none;color:#bbb;padding-left:12px}.share a .hidden{display:none}.share a:hover{color:#333}pre,code{font-size:15px;border:1px solid #e8e8e8;border-radius:3px;background-color:#eef}code{padding:1px 5px}pre{padding:8px 12px;overflow-x:scroll}pre>code{border:0;padding-right:0;padding-left:0}.pagination .disabled{opacity:0}.pull-right{float:right}.amp-social-share-hatena_bookmark{font-family:Verdana;background-color:#00a4de;font-weight:700;color:#fff;line-height:44px;text-align:center;font-size:28px}.amp-social-share-pocket{background-color:#ef3e55;color:#fff;line-height:44px;text-align:center;font-size:44px}.amp-social-share-line{background-color:#00b900;color:#fff;line-height:44px;text-align:center;font-size:44px}.page-navigation{font-size:14px;display:block;width:auto;overflow:hidden}.page-navigation a{display:block;width:50%;float:left;margin:1em 0}.page-navigation .next{text-align:right}</style> <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript> <script async src="https://cdn.ampproject.org/v0.js"></script> </head> <body> <amp-geo layout="nodisplay"> <script type="application/json">
     {
         "ISOCountryGroups": {
             "eea": [ "at", "be", "bg", "cy", "cz", "de", "dk", "ee", "es", "fi", "fr",
                      "gb", "gr", "hr", "hu", "ie", "is", "it", "li", "lt", "lu", "lv", "mt", "nl",
                      "no", "pl", "pt", "ro", "se", "si", "sk"]
         }
     }
    </script> </amp-geo> <amp-consent layout="nodisplay" id="consent-element"> <script type="application/json">
     {
         "consents": {
             "my_consent": {
                 "promptIfUnknownForGeoGroup": "eea",
                 "promptUI": "consent-ui"
             }
         }
     }
    </script> <div id="consent-ui"> <button on="tap:consent-element.accept" role="button">Accept</button> <button on="tap:consent-element.reject" role="button">Reject</button> <button on="tap:consent-element.dismiss" role="button">Dismiss</button> </div> </amp-consent> <amp-auto-ads data-block-on-consent type="adsense" data-ad-client="ca-pub-4711975605457723"></amp-auto-ads> <header class="site-header"> <a href="/" class="logo"><span class="logo"><amp-img src="/assets/images/znz.png" width="48" height="48"/></span></a> <div class="page-links"> <a class="page-link" href="/">Home</a> • <a class="page-link" href="/about/">About</a> </div> </header> <main class="content" role="main"> <article class="post"> <div class="post-meta"> <h1 class="post-title">hamlからslimへの移行でひっかかったこと</h1> <div>Tags: <a href="/tag/ruby/" rel="tag">ruby</a>, <a href="/tag/rails/" rel="tag">rails</a>, <a href="/tag/haml/" rel="tag">haml</a>, <a href="/tag/slim/" rel="tag">slim</a>, <a href="/tag/zsh/" rel="tag">zsh</a></div> <div>Created at: 2014-03-11 13:39:11</div> <div>Last modified at: 2018-03-03 10:14:08</div> </div> <section class="post-content"> <a name="topofpage"></a> <p>haml より slim の方が速いらしいという話を良く見かけるので、 haml から少しずつ slim に移行しようとして、 haml2slim で変換してみたらひっかかりまくりました。</p> <h2 id="インデントがない">インデントがない</h2> <p>haml は生成される HTML がインデントされていてみやすいのですが、 slim は不要なスペースは入れずにコンパクトな HTML が生成されるようで、 単純に比較できなくて困りましたが、 <a href="https://github.com/slim-template/slim#default-options">https://github.com/slim-template/slim#default-options</a> で設定できるようだったので、以下のように設定しました。</p> <p class="filename">config/initializers/slim.rb:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="no">Rails</span><span class="p">.</span><span class="nf">env</span><span class="p">.</span><span class="nf">development?</span>
  <span class="no">Slim</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">set_default_options</span> <span class="ss">pretty: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div> <h2 id="19-hash-style">1.9 hash style</h2> <p><a href="https://github.com/slim-template/haml2slim/pull/23">https://github.com/slim-template/haml2slim/pull/23</a> に pull request がでているように haml で属性を <code class="highlighter-rouge">{foo: bar}</code> のように書く形式には対応していないようです。</p> <h2 id="string-interpolation-がおかしい">string interpolation がおかしい</h2> <p><a href="https://github.com/slim-template/haml2slim/issues/7">https://github.com/slim-template/haml2slim/issues/7</a> などで報告されているように <code class="highlighter-rouge">#{ ... }</code> という書き方の変換で問題があるようです。 <code class="highlighter-rouge">%tag(foo="#{bar}")</code> が <code class="highlighter-rouge">tag(foo="# bar ")</code> になっていて気づきました。</p> <h2 id="html-コメントの中でタグにならない">HTML コメントの中でタグにならない</h2> <div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c">/</span><span class="cs">[if lt IE 9]</span><span class="c">
</span>      <span class="nt">%script</span><span class="p">{</span><span class="ss">src: </span><span class="n">url_for</span><span class="p">(</span><span class="n">html5shiv</span><span class="p">)}</span>
</code></pre></div></div> <p>のように書いていたのが</p> <div class="language-slim highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c">/![if lt IE 9]</span>
      <span class="nt">script</span><span class="w"> </span>src:<span class="w"> </span>url_for(html5shiv)
</code></pre></div></div> <p>のように変換されてさっぱりダメだったので、</p> <div class="language-slim highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c">/[if lt IE 9]</span>
      <span class="nt">script</span>(<span class="na">src</span><span class="p">=</span><span class="s">"#{url_for(html5shiv)}"</span>)
</code></pre></div></div> <p>または</p> <div class="language-slim highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c">/[if lt IE 9]</span>
      <span class="nt">script</span>(<span class="na">src</span><span class="p">=</span><span class="n">url_for</span><span class="p">(</span><span class="n">html5shiv</span><span class="p">)</span>)
</code></pre></div></div> <p>のように書き換えました。 HTML コメント <code class="highlighter-rouge">/!</code> の中だとタグが使えない (そのまま文字列としてコメントの中に入る) ようなので、 IE コンディショナルコメント <code class="highlighter-rouge">/[...]</code> を使う必要があるようです。</p> <h2 id="エラーメッセージがわかりにくい">エラーメッセージがわかりにくい</h2> <p>書き換え途中で、属性値をくくる <code class="highlighter-rouge">""</code> を忘れると エラーメッセージが <code class="highlighter-rouge">syntax error, unexpected ';'</code> としかでないので原因がわかりにくくて困りました。</p> <p>他のところでも ruby のエラーメッセージそのままなので、 閉じ忘れ系は原因の行と離れたところでエラーになって、 行番号もあまり当てにならなくて不便です。</p> <h2 id="真偽値属性の属性値が省略できない">真偽値属性の属性値が省略できない</h2> <p>haml だと <code class="highlighter-rouge">%div(data-pjax-container)</code> で <code class="highlighter-rouge">&lt;div data-pjax-container&gt;</code> に変換できるのに、 slim だと <code class="highlighter-rouge">div(data-pjax-container)</code> が <code class="highlighter-rouge">&lt;div data-pjax-container=""&gt;</code> になってしまって、 <code class="highlighter-rouge">=""</code> が余計です。</p> <p><a href="https://github.com/slim-template/slim/issues/480">Render boolean attributes without value in html5</a> によると <code class="highlighter-rouge">:format</code> を <code class="highlighter-rouge">:html</code> にすれば良いということで</p> <p class="filename">config/initializers/slim.rb:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Slim</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">set_default_options</span> <span class="ss">format: :html</span>
</code></pre></div></div> <p>と設定してみても slim 2.0.2 だと変化がありませんでした。</p> <p>まだリリースされていないバージョンを使う必要があるようで、 <code class="highlighter-rouge">Gemfile</code> で <code class="highlighter-rouge">gem 'slim', github: 'slim-template/slim'</code> と指定して 試そうとしたのですが、 rails 3.2.17 との組み合わせは tilt の要求バージョンの解決が 出来なくて使えませんでした。</p> <p>実験のため slim 専用の Gemfile を用意して以下のように試したところ、 slim と temple の両方をまだリリースされていないバージョンにすると 使えることが確認できました。</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">% mkdir /tmp/slim-test
% cd /tmp/slim-test
% bundle init
</span><span class="gp">% echo 'gem "slim", github: "slim-template/slim"' &gt;</span><span class="o">&gt;</span> Gemfile
<span class="gp">% echo 'gem "temple", github: "judofyr/temple"' &gt;</span><span class="o">&gt;</span> Gemfile
<span class="go">% bundle
% echo 'div(ng-app)' | bundle exec slimrb
</span><span class="gp">&lt;div ng-app=""&gt;</span>&lt;/div&gt;
<span class="go">% echo 'div(ng-app)' | bundle exec slimrb -o format=:html
</span><span class="gp">&lt;div ng-app&gt;</span>&lt;/div&gt;
</code></pre></div></div> <p>今のところ、 <code class="highlighter-rouge">rack-pjax</code> の使用は止めていて、 <code class="highlighter-rouge">=""</code> がつく挙動で直接困ることはなさそうなので、 この問題は保留することにしました。</p> <h2 id="javascript-や-css-の埋め込み">javascript や css の埋め込み</h2> <div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nd">:javascript
</span>      <span class="nb">window</span><span class="p">.</span><span class="nx">current_user_id</span> <span class="o">=</span> <span class="si">#{</span><span class="n">current_user</span><span class="p">.</span><span class="nf">id</span><span class="p">.</span><span class="nf">to_i</span><span class="si">}</span>
</code></pre></div></div> <p>のように書いていたら、</p> <div class="language-slim highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nd">javascript:
</span>      <span class="o">|</span> <span class="nb">window</span><span class="p">.</span><span class="nx">current_user_id</span> <span class="o">=</span> <span class="si">#{</span><span class="n">current_user</span><span class="p">.</span><span class="nf">id</span><span class="p">.</span><span class="nf">to_i</span><span class="si">}</span>
</code></pre></div></div> <p>と変換されて <code class="highlighter-rouge">| </code> がそのまま <code class="highlighter-rouge">script</code> の中身に付いてしまったので、 削除しました。</p> <div class="language-slim highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nd">javascript:
</span>      <span class="nb">window</span><span class="p">.</span><span class="nx">current_user_id</span> <span class="o">=</span> <span class="si">#{</span><span class="n">current_user</span><span class="p">.</span><span class="nf">id</span><span class="p">.</span><span class="nf">to_i</span><span class="si">}</span>
</code></pre></div></div> <p><code class="highlighter-rouge">:css</code> から <code class="highlighter-rouge">css:</code> の変換でも同様でした。 CSS の場合は行頭が記号だと <code class="highlighter-rouge">| </code> がついていないこともありました。</p> <h2 id="空白の有無の問題">空白の有無の問題</h2> <div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="p">=</span> <span class="n">link_to</span> <span class="n">home_path</span><span class="p">,</span> <span class="ss">class: </span><span class="s1">'brand'</span> <span class="k">do</span>
              <span class="p">=</span> <span class="n">image_tag</span><span class="p">(</span><span class="s2">"brand.png"</span><span class="p">,</span> <span class="ss">alt: </span><span class="s2">""</span><span class="p">,</span> <span class="ss">size: </span><span class="s2">"35x35"</span><span class="p">)</span>
              <span class="p">=</span> <span class="n">base_title</span>
</code></pre></div></div> <p>がそのまま slim になっていて、基本的には問題なかったのですが、 haml と違って slim だとタグとタイトルの間に空白が入らなくなってしまって、 見た目が変わってしまっていたので、 <code class="highlighter-rouge">'</code> だけの行を追加して空白が入るようにしました。</p> <div class="language-slim highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="p">=</span> <span class="n">link_to</span> <span class="n">home_path</span><span class="p">,</span> <span class="ss">class: </span><span class="s1">'brand'</span> <span class="k">do</span>
              <span class="p">=</span> <span class="n">image_tag</span><span class="p">(</span><span class="s2">"brand.png"</span><span class="p">,</span> <span class="ss">alt: </span><span class="s2">""</span><span class="p">,</span> <span class="ss">size: </span><span class="s2">"35x35"</span><span class="p">)</span>
              <span class="p">'</span>
              <span class="p">=</span> <span class="n">base_title</span>
</code></pre></div></div> <h2 id="end-が抜けるバグで-syntaxerror">end が抜けるバグで SyntaxError</h2> <p><code class="highlighter-rouge">syntax error, unexpected keyword_ensure, expecting keyword_end</code> になるので原因を調べてみたところ、 インデントの中の最初がコメントだと、 そのブロックの <code class="highlighter-rouge">end</code> が抜けてしまうようです。</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">% echo $</span><span class="s1">'- if true\n  / comment'</span> | bundle <span class="nb">exec </span>slimrb <span class="nt">-e</span>
<span class="go">&lt;% if true

</span><span class="gp"> %&gt;</span>
<span class="gp">% echo $</span><span class="s1">'- if true\n  |'</span> | bundle <span class="nb">exec </span>slimrb <span class="nt">-e</span>
<span class="go">&lt;% if true

</span><span class="gp">end %&gt;</span>
<span class="gp">% echo $</span><span class="s1">'- articles.each do |a|\n  / comment'</span> | bundle <span class="nb">exec </span>slimrb <span class="nt">-e</span>
<span class="go">&lt;% articles.each do |a|

</span><span class="gp"> %&gt;</span>
<span class="gp">% echo $</span><span class="s1">'- articles.each do |a|\n  | text'</span> | bundle <span class="nb">exec </span>slimrb <span class="nt">-e</span>
<span class="go">&lt;% articles.each do |a|
</span><span class="gp"> %&gt;</span>text&lt;%
<span class="gp">%&gt;</span>&lt;% end %&gt;
<span class="gp">% echo $</span><span class="s1">'- articles.each do |a|\n  / comment\n/ more comment'</span> | bundle <span class="nb">exec </span>slimrb <span class="nt">-e</span>
<span class="go">&lt;% articles.each do |a|


</span><span class="gp"> %&gt;</span>
<span class="gp">% echo $</span><span class="s1">'- articles.each do |a|\n  / comment\n| text\n/ more comment'</span> | bundle <span class="nb">exec </span>slimrb <span class="nt">-e</span>
<span class="go">&lt;% articles.each do |a|

</span><span class="gp"> %&gt;</span>text&lt;%
<span class="gp">%&gt;</span>&lt;%
<span class="gp">%&gt;</span>
<span class="gp">% echo $</span><span class="s1">'- articles.each do |a|\n  / comment\n| text\n'</span> | bundle <span class="nb">exec </span>slimrb <span class="nt">-e</span>
<span class="go">&lt;% articles.each do |a|

</span><span class="gp"> %&gt;</span>text&lt;%
<span class="gp">%&gt;</span>
</code></pre></div></div> <p>この件は <a href="https://github.com/slim-template/slim/issues/485">https://github.com/slim-template/slim/issues/485</a> で報告してみました。</p> <h2 id="ファイル名の指定が面倒">ファイル名の指定が面倒</h2> <p>これは slim や haml2slim の問題ではないのですが、 zsh で久しぶりに compctl を使って</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>compctl -g '*.haml' + -g '*(-/)' haml2slim
</code></pre></div></div> <p>と設定しましたが、ちゃんと compsys を使った方が良いと思い直して、</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>compdef '_files -g "*.haml"' haml2slim
</code></pre></div></div> <p>と設定しました。</p> <h2 id="感想">感想</h2> <p>シンプルとか入力が楽とかいう主観的なものは個人的には同意できなくて利点とは思えないので、 速いという客観的な理由で slim への移行をしているのですが、 haml2slim の出来が悪かったり、 空白の扱いの違いで同じようなソースからでも最終的な見た目が違うものが出来たりして、 移行は思ったより大変な印象を受けました。</p> <p>はまりどころさえわかっていれば、そこを注意して haml2slim での変換結果を修正していけば良いので、途中からはどんどん変換していけるようになりました。 (まだ一部しか終わっていませんが。)</p> <p>それなりの数の変換をしてみた結果、最初から slim で書くようにすれば haml と大きな違いはなさそうにも感じました。</p> <p><code class="highlighter-rouge">end</code> 抜けなどの問題が起きたことから、 haml と比べていろんな書き方で使われていなさそうということで、 まだ安定してなさそうと感じました。</p> <p>また属性値なしの <code class="highlighter-rouge">&lt;div ng-app&gt;</code> のような出力に対応しているリリースがまだないなど、 融通が利かない点があって問題が起きそうな可能性がありそうだと感じました。</p> </section> <div class="page-navigation"> <a class="prev" href="/blog/2014-03-11-hash-reject.html">&laquo; Ruby 2.1.1のHash#rejectの不具合対策</a> <a class="next" href="/blog/2014-03-14-bootstrap-2-to-3.html">bootstrap 2.3.2 から bootstrap 3.1.1 への移行 &raquo;</a> </div> <amp-iframe width=600 height=140 layout="responsive" sandbox="allow-scripts allow-same-origin allow-modals allow-popups allow-forms" resizable src="https://cdn.rawgit.com/znz/blog.n-z.jp/1d5c7e5949ec913739b8544d79d9bdca9fa365c9/_disqus.html#https://blog.n-z.jp/blog/2014-03-11-haml-to-slim.html"> <div overflow tabindex=0 role=button aria-label="Disqus Comments">Disqus Comments</div> </amp-iframe> <footer class="post-footer"> <section class="share"> <a class="icon" href="https://twitter.com/intent/tweet?url=https://blog.n-z.jp/blog/haml-to-slim&text=haml%E3%81%8B%E3%82%89slim%E3%81%B8%E3%81%AE%E7%A7%BB%E8%A1%8C%E3%81%A7%E3%81%B2%E3%81%A3%E3%81%8B%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8&via=znz" target="_blank"> Share on </a> <amp-social-share type="system"></amp-social-share> <amp-social-share type="email"></amp-social-share> <amp-social-share type="linkedin"></amp-social-share> <amp-social-share type="pinterest"></amp-social-share> <amp-social-share type="gplus"></amp-social-share> <amp-social-share type="tumblr"></amp-social-share> <amp-social-share type="twitter"></amp-social-share> <amp-social-share type="whatsapp"></amp-social-share> <amp-social-share type="sms"></amp-social-share> <amp-social-share type="hatena_bookmark" data-share-endpoint="http://b.hatena.ne.jp/append?SOURCE_URL"> B! </amp-social-share> <amp-social-share type="pocket" data-share-endpoint="http://getpocket.com/edit?url=SOURCE_URL"> <i class="fab fa-get-pocket"></i> </amp-social-share> <amp-social-share type="line" data-share-endpoint="http://line.me/R/msg/text/?TITLE%3ASOURCE_URL"> <i class="fab fa-line"></i> </amp-social-share> </section> </footer> <div class="bottom-teaser cf"> <div class="isLeft"> <h5 class="index-headline featured"><span>Written by</span></h5> <section class="author"> <div class="author-image"></div> <h4>Kazuhiro NISHIYAMA</h4> <p class="bio"><a href="https://github.com/ruby/ruby/graphs/contributors">Ruby のコミッター</a>とかやってます。 フルスタックエンジニア(って何?)かもしれません。 <a href="https://www.n-z.jp/me.html">About znz</a>に主なアカウントをまとめました。 </p> <p> <span> <span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg> </span><a href="https://github.com/znz"><span class="username">znz</span></a> </span> <span> <span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg> </span><a href="https://twitter.com/znz"><span class="username">znz</span></a> </span> </p> <hr> <p class="published">Published <time datetime="2014-03-11 13:39">11 Mar 2014</time></p> </section> </div> <div class="isRight"> <h5 class="index-headline featured"><span>Supported by</span></h5> <footer class="site-footer"> <section class="poweredby">Proudly published with <a href="http://jekyllrb.com"> Jekyll</a> and <a href="https://github.com/ageitgey/amplify">Amplify</a></section> <a class="subscribe" href="/feed.xml"> <span class="tooltip"> <i class="fa fa-rss"></i> You should subscribe to my feed.</span></a> <div class="inner"> <section class="copyright">All content copyright <a href="mailto:zn@mbf.nifty.com">Kazuhiro NISHIYAMA</a> &copy; 2018<br>All rights reserved.</section> </div> </footer> </div> </div> </article> </main> <amp-analytics data-block-on-consent type="googleanalytics" id="amp-analytics"> <script type="application/json">
{
  "vars": {
    "account": "UA-43859023-1"
  },
  "triggers": {
    "trackPageview": {
      "on": "visible",
      "request": "pageview"
    }
  }
}
</script> </amp-analytics></body> </html>