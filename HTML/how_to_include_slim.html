<!DOCTYPE html><html><head><meta charset="utf-8" /><title>slimでDRYなhtmlを生成してsinatraに載せる</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><script async="" src="https://www.googletagmanager.com/gtag/js?id=AW-935296116"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'AW-935296116');

// Event snippet for qiita remarketing page
gtag('event', 'conversion', {
    'send_to': 'AW-935296116/jvRhCOaj5YYBEPT4_b0D',
    'value': 1.0,
    'currency': 'JPY',
    'aw_remarketing_only': true
});</script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="ZXNGE7vKzSSi5aqEg3f/PqAajHCVNnD4bW6mj0qr3UFfRFMkdKkSscDucZQYTTfeQgiLp62PdJuLKFehT8axHA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-f9a6afad761ec2306e10db2736187c8b.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/style-f9c7b2fa9663403c85f7a8137924e09b.min.css" /><script src="https://cdn.qiita.com/assets/public/bundle-f4aa1a5bd9184548767a72d1e192e2d8.min.js" defer="defer"></script><meta content="summary" name="twitter:card" /><meta content="@Qiita" name="twitter:site" /><meta content="@HKDnet" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="slimでDRYなhtmlを生成してsinatraに載せる - Qiita"><meta property="og:image" content="https://cdn.qiita.com/assets/qiita-fb-2887e7b4aad86fd8c25cea84846f2236.png"><meta property="og:description" content="
## モチベーション

* `sinatra`でtemplate engineを使いたかった
* サイトにfooterなどを付けたかったので「コンポーネント化」的な機能が欲しかった
	- 共通部分を独立したファイルに切り出して呼び出..."><meta content="https://qiita.com/HKDnet/items/d333bab990fc60e5e179" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /></head><body><div class="allWrapper"><div data-hyperapp-app="GlobalHeader" data-hyperapp-props="{&quot;unreadNotificationsCount&quot;:null,&quot;realms&quot;:[{&quot;humanName&quot;:&quot;Qiita&quot;,&quot;isCurrentRealm&quot;:true,&quot;isQiita&quot;:true,&quot;isQiitaTeam&quot;:false,&quot;loggedInUser&quot;:null,&quot;teamId&quot;:null,&quot;url&quot;:&quot;https://qiita.com/&quot;}],&quot;teamFindUrl&quot;:&quot;https://teams-center.qiita.com/find_team&quot;,&quot;isTeamOnlyUser&quot;:null,&quot;currentUser&quot;:null}"><div class="st-Header" id="globalHeader"><div class="st-Header_container"><div class="st-Header_start"><a class="st-Header_logo mr-1" href="/"><svg viewBox="0 0 75 25" xmlns="http://www.w3.org/2000/svg"><title>Qiita</title><path d="M24.6 12.2C24.6 6.2 20 0 12.2 0 6.2 0 0 4.6 0 12.4c0 6 4.6 12.2 12.4 12.2 2.5 0 5-.8 7.1-2.3l3.6 3.6 1.6-1.6-3.4-3.4c2.1-2.3 3.3-5.3 3.3-8.7zm-12.4-10c5.7 0 10.2 4.4 10.2 10.1 0 4.9-3.8 10.1-10.1 10.1s-10.1-5.1-10.1-10c0-6.4 5.1-10.2 10-10.2zM30.5 7.1h2.1v17h-2.1zM31.5 4.8c-1 0-1.8-.8-1.8-1.8s.8-1.8 1.8-1.8 1.8.8 1.8 1.8-.8 1.8-1.8 1.8zM40 4.8c-1 0-1.8-.8-1.8-1.8S39 1.2 40 1.2s1.8.8 1.8 1.8S41 4.8 40 4.8zM39 7.1h2.1v17H39zM53.7 24.4c-3.9 0-6.2-3-6.2-6v-16h2.1v4.7H57v2.1h-7.4v9.3c0 1.9 1.5 3.9 4.1 3.9.7 0 1.4-.2 2-.6l.2-.1 1 1.8-.2.1c-.9.5-2 .8-3 .8zM67.6 24.5c-5.7 0-9.1-4.5-9.1-8.9 0-5.7 4.5-9.1 8.9-9.1 2.3 0 4.1.8 5.4 2.3V7.1h2.1v17h-2.1v-1.9c-1.2 1.5-3 2.3-5.2 2.3zm-.2-15.9c-3.4 0-6.8 2.6-6.8 7 0 3.4 2.6 6.8 7 6.8 2 0 4-.9 5.3-2.5v-8.8c-1.4-1.6-3.3-2.5-5.5-2.5z"></path></svg></a><div><div class="st-Header_realmSelector"><span class="fa fa-fw fa-caret-down"></span></div></div><div><div class="st-Header_community">コミュニティ<span class="fa fa-fw fa-caret-down ml-1of2"></span></div></div><form class="st-Header_search"><span class="fa fa-search"></span><input class="st-Header_searchInput" placeholder="キーワードを入力" type="search" /></form><div class="st-Header_searchButton"><span class="fa fa-serach"></span></div></div><div class="st-Header_end"><a class="st-Header_signupButton" href="/signup">ユーザ登録</a><a class="st-Header_loginLink" href="/login">ログイン</a></div></div></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/ruby","name":"Ruby"}}]}</script><script async="" src="https://cdn.bigmining.com/private/js/qiita_bigmining.js"></script><div style="display:none"><div class="TagList__label"><span></span><span>Ruby</span></div><div class="TagList__label"><span></span><span>Sinatra</span></div><div class="TagList__label"><span></span><span>slim</span></div></div><img style="display:block;margin:0;padding:0;border:0;outline:0;width:0;height:0;line-height:0;" alt="" src="https://relay-dsp.ad-m.asia/dmp/sync/bizmatrix?pid=c3ed207b574cf11376&amp;d=x18o8hduaj&amp;uid=" /><div data-hyperapp-app="PersonalPublicArticle" data-hyperapp-props="{&quot;article&quot;:{&quot;body&quot;:&quot;\n\u003ch2\u003e\n\u003cspan id=\&quot;モチベーション\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#%E3%83%A2%E3%83%81%E3%83%99%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003eモチベーション\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003esinatra\u003c/code\u003eでtemplate engineを使いたかった\u003c/li\u003e\n\u003cli\u003eサイトにfooterなどを付けたかったので「コンポーネント化」的な機能が欲しかった\n\n\u003cul\u003e\n\u003cli\u003e共通部分を独立したファイルに切り出して呼び出せること\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;結果\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#%E7%B5%90%E6%9E%9C\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003e結果\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eslimを使ったら満足できた。\u003c/li\u003e\n\u003cli\u003ehamlやerbで満足できるのかは不明。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;下調べ\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#%E4%B8%8B%E8%AA%BF%E3%81%B9\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003e下調べ\u003c/h2\u003e\n\n\u003cp\u003eRuby系のテンプレートエンジンは3つ強いのがあるっぽい。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eerb\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ehaml\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eslim\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eそれぞれの詳しい評価は下記リンクに詳しい。\u003cbr\u003e\n\u003ca href=\&quot;http://ruby-rails.hatenadiary.com/entry/20141001/1412169453\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003eRailsのテンプレートエンジンの比較 erb vs slim vs haml - Rails Webook\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこれを見た印象で\u003ccode\u003eslim\u003c/code\u003eを触ってみようかと思い、「コンポーネント化」できるか調べた。\u003c/p\u003e\n\n\u003cp\u003e機能的には\u003ccode\u003einclude\u003c/code\u003eとかいう名前かなーと思って調べたらまさにそれがヒットした。\u003cbr\u003e\n\u003ca href=\&quot;http://blogged.e2esound.com/2014/09/17/slim-include/\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003eテンプレートエンジンSlim単体でファイル分割する\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e上記の記事で公式日本語ドキュメントにもPRがいって記載があるみたいだけど、\u003ccode\u003esinatra\u003c/code\u003eに載せる例がなかったのでそこをこの記事で補足しておこうと思う。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;sinatraでslimを使う\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#sinatra%E3%81%A7slim%E3%82%92%E4%BD%BF%E3%81%86\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003esinatraでslimを使う\u003c/h2\u003e\n\n\u003cp\u003eまず\u003ccode\u003eslim\u003c/code\u003e導入前の\u003ccode\u003esinatra\u003c/code\u003eでの構成はこんな感じ。\u003cbr\u003e\n今からここに\u003ccode\u003eindex\u003c/code\u003eという名前のslimファイルを作成してGET &#39;/&#39;に割り当てる。\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;bash\&quot;\u003e\n\u003cdiv class=\&quot;code-lang\&quot;\u003e\u003cspan class=\&quot;bold\&quot;\u003emyproject\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003eapp.rb\nconfig.ru\nGemfile\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eslim\u003c/code\u003e導入のために\u003ccode\u003eGemfile\u003c/code\u003eに以下を追記。\u003cbr\u003e\n完了後はもちろん\u003ccode\u003ebundle install\u003c/code\u003eしておく。\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;ruby\&quot;\u003e\n\u003cdiv class=\&quot;code-lang\&quot;\u003e\u003cspan class=\&quot;bold\&quot;\u003eGemfile\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;n\&quot;\u003egem\u003c/span\u003e \u003cspan class=\&quot;s1\&quot;\u003e&#39;slim&#39;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003esinatra\u003c/code\u003eのルーティングを管理してるクラスで\u003ccode\u003eslim\u003c/code\u003eメソッドで\u003ccode\u003e:index\u003c/code\u003eを返す。\u003cbr\u003e\nこのシンボルはslimファイルの名称と一致する必要がある。\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;ruby\&quot;\u003e\n\u003cdiv class=\&quot;code-lang\&quot;\u003e\u003cspan class=\&quot;bold\&quot;\u003eapp.rb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;nb\&quot;\u003erequire\u003c/span\u003e \u003cspan class=\&quot;s1\&quot;\u003e&#39;sinatra&#39;\u003c/span\u003e\n\u003cspan class=\&quot;nb\&quot;\u003erequire\u003c/span\u003e \u003cspan class=\&quot;s1\&quot;\u003e&#39;slim&#39;\u003c/span\u003e\n\n\u003cspan class=\&quot;c1\&quot;\u003e# routing\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eclass\u003c/span\u003e \u003cspan class=\&quot;nc\&quot;\u003eApp\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\&quot;no\&quot;\u003eSinatra\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e\u003cspan class=\&quot;no\&quot;\u003eBase\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003eget\u003c/span\u003e \u003cspan class=\&quot;s1\&quot;\u003e&#39;/&#39;\u003c/span\u003e \u003cspan class=\&quot;k\&quot;\u003edo\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003eslim\u003c/span\u003e \u003cspan class=\&quot;ss\&quot;\u003e:index\u003c/span\u003e\n  \u003cspan class=\&quot;k\&quot;\u003eend\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eslimファイル自体を\u003ccode\u003eviews/\u003c/code\u003e配下に追加。\u003cbr\u003e\nファイル名はシンボルと合わせる(大事なことなので\u003cbr\u003e\n今回はサンプルのため特に動的に値を割り当てることはしない。\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;slim\&quot;\u003e\n\u003cdiv class=\&quot;code-lang\&quot;\u003e\u003cspan class=\&quot;bold\&quot;\u003eviews/index.slim\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;nn\&quot;\u003edoctype\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003ehtml\n\u003cspan class=\&quot;nt\&quot;\u003ehtml\u003c/span\u003e\n  \u003cspan class=\&quot;nt\&quot;\u003ehead\u003c/span\u003e\n    \u003cspan class=\&quot;nt\&quot;\u003etitle\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003eSlim\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003eExamples\n    \u003cspan class=\&quot;nt\&quot;\u003emeta\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003e\u003cspan class=\&quot;na\&quot;\u003ename\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;keywords\&quot;\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003e\u003cspan class=\&quot;na\&quot;\u003econtent\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;template language\&quot;\u003c/span\u003e\n    \u003cspan class=\&quot;nt\&quot;\u003emeta\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003e\u003cspan class=\&quot;na\&quot;\u003ename\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;author\&quot;\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003e\u003cspan class=\&quot;na\&quot;\u003econtent\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;hkdnet\&quot;\u003c/span\u003e\n  \u003cspan class=\&quot;nt\&quot;\u003ebody\u003c/span\u003e\n    \u003cspan class=\&quot;nt\&quot;\u003eh1\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003eMarkup\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003eexamples\n    \u003cspan class=\&quot;nt\&quot;\u003ediv\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003e\u003cspan class=\&quot;na\&quot;\u003eid\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;footer\&quot;\u003c/span\u003e\n      \u003cspan class=\&quot;p\&quot;\u003e|\u003c/span\u003e Copyright \u003cspan class=\&quot;ni\&quot;\u003e\u0026amp;copy;\u003c/span\u003e 2015 hkdnet\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eここまででファイル構成は以下のようになる\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;bash\&quot;\u003e\n\u003cdiv class=\&quot;code-lang\&quot;\u003e\u003cspan class=\&quot;bold\&quot;\u003emyproject\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003eapp.rb\nconfig.ru\nGemfile\nviews\n └index.slim\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれでいつもどおり\u003ccode\u003esinatra\u003c/code\u003eを起動すれば動く\u003cimg alt=\&quot;:thumbsup:\&quot; class=\&quot;emoji\&quot; height=\&quot;20\&quot; src=\&quot;https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png\&quot; title=\&quot;:thumbsup:\&quot; width=\&quot;20\&quot;\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;dryな構成にする\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#dry%E3%81%AA%E6%A7%8B%E6%88%90%E3%81%AB%E3%81%99%E3%82%8B\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003eDRYな構成にする\u003c/h2\u003e\n\n\u003cp\u003eコンポーネントとしてまとまっている部分を別ファイルにくくりだし、\u003cbr\u003e\nそれを\u003ccode\u003esinatra/include\u003c/code\u003eするようにする。\u003c/p\u003e\n\n\u003cp\u003e具体的には\u003ccode\u003eid=\&quot;footer\&quot;\u003c/code\u003eなる要素が繰り返されそうなので、それを\u003ccode\u003efooter.slim\u003c/code\u003eとして別ファイルに切り出す。\u003cbr\u003e\nそして\u003ccode\u003eindex.slim\u003c/code\u003e側では\u003ccode\u003einclude footer\u003c/code\u003eとすればそこに展開されるようにする。\u003c/p\u003e\n\n\u003cp\u003eまずはルーティング管理クラスで\u003ccode\u003erequire &#39;slim/include&#39;\u003c/code\u003eしておく。\u003cbr\u003e\nそれ以外は特に不要。\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;ruby\&quot;\u003e\n\u003cdiv class=\&quot;code-lang\&quot;\u003e\u003cspan class=\&quot;bold\&quot;\u003eapp.rb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;nb\&quot;\u003erequire\u003c/span\u003e \u003cspan class=\&quot;s1\&quot;\u003e&#39;sinatra&#39;\u003c/span\u003e\n\u003cspan class=\&quot;nb\&quot;\u003erequire\u003c/span\u003e \u003cspan class=\&quot;s1\&quot;\u003e&#39;slim&#39;\u003c/span\u003e\n\u003cspan class=\&quot;nb\&quot;\u003erequire\u003c/span\u003e \u003cspan class=\&quot;s1\&quot;\u003e&#39;slim/include&#39;\u003c/span\u003e \u003cspan class=\&quot;c1\&quot;\u003e#add\u003c/span\u003e\n\n\u003cspan class=\&quot;c1\&quot;\u003e# routing\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eclass\u003c/span\u003e \u003cspan class=\&quot;nc\&quot;\u003eApp\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\&quot;no\&quot;\u003eSinatra\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e\u003cspan class=\&quot;no\&quot;\u003eBase\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003eget\u003c/span\u003e \u003cspan class=\&quot;s1\&quot;\u003e&#39;/&#39;\u003c/span\u003e \u003cspan class=\&quot;k\&quot;\u003edo\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003eslim\u003c/span\u003e \u003cspan class=\&quot;ss\&quot;\u003e:index\u003c/span\u003e\n  \u003cspan class=\&quot;k\&quot;\u003eend\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e次に切り出したい箇所を別ファイルにする。\u003cbr\u003e\nこのときネスト数は特に気にしなくてよい(と思う)\u003cbr\u003e\nというかエディタが勝手にインデント消したけど普通に動いた\u003cimg alt=\&quot;:moyai:\&quot; class=\&quot;emoji\&quot; height=\&quot;20\&quot; src=\&quot;https://cdn.qiita.com/emoji/twemoji/unicode/1f5ff.png\&quot; title=\&quot;:moyai:\&quot; width=\&quot;20\&quot;\u003e\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;slim\&quot;\u003e\n\u003cdiv class=\&quot;code-lang\&quot;\u003e\u003cspan class=\&quot;bold\&quot;\u003eviews/footer.slim\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;nt\&quot;\u003ediv\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003e\u003cspan class=\&quot;na\&quot;\u003eid\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;footer\&quot;\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e|\u003c/span\u003e Copyright \u003cspan class=\&quot;ni\&quot;\u003e\u0026amp;copy;\u003c/span\u003e 2015 hkdnet\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e最後にfooterを呼び出す。\u003cbr\u003e\nincludeの引数にクォートをつけてはいけない。\u003cbr\u003e\n.slimはあってもなくてもよい。\u003cbr\u003e\nカレントディレクトリを基準に探査するが、引数に追加すれば変更できるようだ。\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;slim\&quot;\u003e\n\u003cdiv class=\&quot;code-lang\&quot;\u003e\u003cspan class=\&quot;bold\&quot;\u003eviews/index.slim\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;nn\&quot;\u003edoctype\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003ehtml\n\u003cspan class=\&quot;nt\&quot;\u003ehtml\u003c/span\u003e\n  \u003cspan class=\&quot;nt\&quot;\u003ehead\u003c/span\u003e\n    \u003cspan class=\&quot;nt\&quot;\u003etitle\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003eSlim\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003eExamples\n    \u003cspan class=\&quot;nt\&quot;\u003emeta\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003e\u003cspan class=\&quot;na\&quot;\u003ename\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;keywords\&quot;\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003e\u003cspan class=\&quot;na\&quot;\u003econtent\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;template language\&quot;\u003c/span\u003e\n    \u003cspan class=\&quot;nt\&quot;\u003emeta\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003e\u003cspan class=\&quot;na\&quot;\u003ename\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;author\&quot;\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003e\u003cspan class=\&quot;na\&quot;\u003econtent\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;hkdnet\&quot;\u003c/span\u003e\n  \u003cspan class=\&quot;nt\&quot;\u003ebody\u003c/span\u003e\n    \u003cspan class=\&quot;nt\&quot;\u003eh1\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003eMarkup\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003eexamples\n    \u003cspan class=\&quot;nt\&quot;\u003einclude\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003efooter\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれで動くようになった\u003cimg alt=\&quot;:beer:\&quot; class=\&quot;emoji\&quot; height=\&quot;20\&quot; src=\&quot;https://cdn.qiita.com/emoji/twemoji/unicode/1f37a.png\&quot; title=\&quot;:beer:\&quot; width=\&quot;20\&quot;\u003e\u003cbr\u003e\nなおこのときのフォルダ構成は以下のようになっている\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;bash\&quot;\u003e\n\u003cdiv class=\&quot;code-lang\&quot;\u003e\u003cspan class=\&quot;bold\&quot;\u003emyproject\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003eapp.rb\nconfig.ru\nGemfile\nviews\n ├footer.slim\n └index.slim\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;おまけ\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#%E3%81%8A%E3%81%BE%E3%81%91\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003eおまけ\u003c/h2\u003e\n\n\u003cp\u003eドキュメントを読んだわけではないが、includeしたときにもrubyコードの解釈は当然実施される。\u003c/p\u003e\n\n\u003cp\u003e例えば以下の書き換えは有効である。\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;ruby\&quot;\u003e\n\u003cdiv class=\&quot;code-lang\&quot;\u003e\u003cspan class=\&quot;bold\&quot;\u003eapp.rb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;nb\&quot;\u003erequire\u003c/span\u003e \u003cspan class=\&quot;s1\&quot;\u003e&#39;sinatra&#39;\u003c/span\u003e\n\u003cspan class=\&quot;nb\&quot;\u003erequire\u003c/span\u003e \u003cspan class=\&quot;s1\&quot;\u003e&#39;slim&#39;\u003c/span\u003e\n\u003cspan class=\&quot;nb\&quot;\u003erequire\u003c/span\u003e \u003cspan class=\&quot;s1\&quot;\u003e&#39;slim/include&#39;\u003c/span\u003e \u003cspan class=\&quot;c1\&quot;\u003e#add\u003c/span\u003e\n\n\u003cspan class=\&quot;c1\&quot;\u003e# routing\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eclass\u003c/span\u003e \u003cspan class=\&quot;nc\&quot;\u003eApp\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\&quot;no\&quot;\u003eSinatra\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e\u003cspan class=\&quot;no\&quot;\u003eBase\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003eget\u003c/span\u003e \u003cspan class=\&quot;s1\&quot;\u003e&#39;/&#39;\u003c/span\u003e \u003cspan class=\&quot;k\&quot;\u003edo\u003c/span\u003e\n    \u003cspan class=\&quot;vi\&quot;\u003e@arr\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e1\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;mi\&quot;\u003e2\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;mi\&quot;\u003e3\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003eslim\u003c/span\u003e \u003cspan class=\&quot;ss\&quot;\u003e:index\u003c/span\u003e\n  \u003cspan class=\&quot;k\&quot;\u003eend\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\&quot;before\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#before\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003ebefore\u003c/h3\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;slim\&quot;\u003e\n\u003cdiv class=\&quot;code-lang\&quot;\u003e\u003cspan class=\&quot;bold\&quot;\u003eviews/index.slim\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;nt\&quot;\u003eul\u003c/span\u003e\u003cspan class=\&quot;nf\&quot;\u003e#numbers\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e-\u003c/span\u003e \u003cspan class=\&quot;vi\&quot;\u003e@arr\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;nf\&quot;\u003eeach\u003c/span\u003e \u003cspan class=\&quot;k\&quot;\u003edo\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e|\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e|\u003c/span\u003e\n    \u003cspan class=\&quot;nt\&quot;\u003eli\u003c/span\u003e\u003cspan class=\&quot;nc\&quot;\u003e.item\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\&quot;after\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#after\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003eafter\u003c/h3\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;slim\&quot;\u003e\n\u003cdiv class=\&quot;code-lang\&quot;\u003e\u003cspan class=\&quot;bold\&quot;\u003eviews/index.slim\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;nt\&quot;\u003eul\u003c/span\u003e\u003cspan class=\&quot;nf\&quot;\u003e#numbers\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e-\u003c/span\u003e \u003cspan class=\&quot;vi\&quot;\u003e@arr\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;nf\&quot;\u003eeach\u003c/span\u003e \u003cspan class=\&quot;k\&quot;\u003edo\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e|\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e|\u003c/span\u003e\n    \u003cspan class=\&quot;nt\&quot;\u003einclude\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003eitem\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;slim\&quot;\u003e\n\u003cdiv class=\&quot;code-lang\&quot;\u003e\u003cspan class=\&quot;bold\&quot;\u003eviews/item.slim\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;nt\&quot;\u003eli\u003c/span\u003e\u003cspan class=\&quot;nc\&quot;\u003e.item\u003c/span\u003e\u003cspan class=\&quot;w\&quot;\u003e \u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこのときitem.slimでは変数eは影も形もないが\u003cbr\u003e\nindex.slimで使うeを正しく参照できる。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;参考\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#%E5%8F%82%E8%80%83\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\&quot;http://ruby-rails.hatenadiary.com/entry/20141001/1412169453\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003eRailsのテンプレートエンジンの比較 erb vs slim vs haml - Rails Webook\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\&quot;http://blogged.e2esound.com/2014/09/17/slim-include/\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003eテンプレートエンジンSlim単体でファイル分割する\u003c/a\u003e\u003c/p\u003e\n&quot;,&quot;createdAt&quot;:&quot;2015-07-21T17:53:49Z&quot;,&quot;elapsedYearsFromUpdatedAt&quot;:3,&quot;isDeprecated&quot;:true,&quot;isDestroyableByViewer&quot;:false,&quot;isEditRequestSendableByViewer&quot;:true,&quot;isLikableByViewer&quot;:true,&quot;isLikedByViewer&quot;:false,&quot;isPublic&quot;:true,&quot;isSlide&quot;:false,&quot;isStockableByViewer&quot;:true,&quot;isStockedByViewer&quot;:false,&quot;isUpdatableByViewer&quot;:false,&quot;isUpdated&quot;:false,&quot;likesCount&quot;:15,&quot;originalId&quot;:317294,&quot;title&quot;:&quot;slimでDRYなhtmlを生成してsinatraに載せる&quot;,&quot;toc&quot;:&quot;\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E3%83%A2%E3%83%81%E3%83%99%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\&quot;\u003eモチベーション\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E7%B5%90%E6%9E%9C\&quot;\u003e結果\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E4%B8%8B%E8%AA%BF%E3%81%B9\&quot;\u003e下調べ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#sinatra%E3%81%A7slim%E3%82%92%E4%BD%BF%E3%81%86\&quot;\u003esinatraでslimを使う\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#dry%E3%81%AA%E6%A7%8B%E6%88%90%E3%81%AB%E3%81%99%E3%82%8B\&quot;\u003eDRYな構成にする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E3%81%8A%E3%81%BE%E3%81%91\&quot;\u003eおまけ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#before\&quot;\u003ebefore\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#after\&quot;\u003eafter\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E5%8F%82%E8%80%83\&quot;\u003e参考\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n&quot;,&quot;totalPv&quot;:3804,&quot;updatedAt&quot;:&quot;2015-07-21T17:53:49Z&quot;,&quot;uuid&quot;:&quot;d333bab990fc60e5e179&quot;,&quot;adventCalendarItem&quot;:null,&quot;author&quot;:{&quot;description&quot;:null,&quot;name&quot;:&quot;はくどー&quot;,&quot;profileImageUrl&quot;:&quot;https://qiita-image-store.s3.amazonaws.com/0/48144/profile-images/1473691245&quot;,&quot;urlName&quot;:&quot;HKDnet&quot;,&quot;isFollowedByViewer&quot;:false,&quot;isFollowableByViewer&quot;:true,&quot;websiteUrl&quot;:&quot;&quot;,&quot;organizations&quot;:{&quot;edges&quot;:[]}},&quot;tags&quot;:[{&quot;name&quot;:&quot;Ruby&quot;,&quot;urlName&quot;:&quot;ruby&quot;},{&quot;name&quot;:&quot;Sinatra&quot;,&quot;urlName&quot;:&quot;sinatra&quot;},{&quot;name&quot;:&quot;slim&quot;,&quot;urlName&quot;:&quot;slim&quot;}],&quot;followingLikers&quot;:{&quot;edges&quot;:[]},&quot;comments&quot;:{&quot;totalCount&quot;:0}},&quot;analyticsTrackingId&quot;:null}"><article itemscope="itemscope" itemtype="http://schema.org/Article" class="p-items"><div class="p-items_wrapper"><div class="p-items_container"><div class="p-items_stickyMenu it-Actions"><div class="it-Actions_item it-Actions_item-like likable"><a class="it-Actions_likeCount" href="/HKDnet/items/d333bab990fc60e5e179/likers">15</a><button><i class="fa fa-fw fa-thumbs-up"></i></button></div><div class="it-Actions_item it-Actions_item-stock"><button><i class="fa fa-folder-open"></i></button></div><div class="it-Actions_jumpToCommentButton"><div class="it-Actions_commentCount"></div><div class="fa fa-fw fa-comment"></div></div><div class="it-Actions_shareButton it-Actions_shareButton-twitter"><span class="fa fa-twitter"></span></div><div class="it-Actions_shareButton it-Actions_shareButton-facebook"><span class="fa fa-facebook"></span></div></div><div class="p-items_main"><div class="p-items_article"><div class="it-Header"><div class="u-flex-center-between mb-3"><div class="it-Header_info"><div class="it-Header_author"><a href="/HKDnet"><img class="it-Header_authorImage" src="https://qiita-image-store.s3.amazonaws.com/0/48144/profile-images/1473691245" alt="1473691245" /></a><a class="it-Header_authorName" href="/HKDnet">@HKDnet</a> </div><div class="it-Header_time"></div><div class="it-Header_meta"><div class="it-Header_manipulate"><div class="dropdown"><span class="dropdown-toggle" tabindex="0"><span class="fa fa-ellipsis-h fa-lg"></span></span></div></div></div></div></div><h1 class="it-Header_title" itemprop="headline">slimでDRYなhtmlを生成してsinatraに載せる</h1><div class="it-Tags"><a class="it-Tags_item" href="/tags/ruby"><span>Ruby</span></a><a class="it-Tags_item" href="/tags/sinatra"><span>Sinatra</span></a><a class="it-Tags_item" href="/tags/slim"><span>slim</span></a></div></div><div class="it-ActionsMobile"><div class="it-ActionsMobile_like likable"><button><span class="fa fa-fw fa-thumbs-up" /><span>15</span></button></div><div class="it-ActionsMobile_stock"><button><div class="fa fa-folder-open"></div></button></div></div><div class="it-DeprecationAlert_three mb-5 p-2"><span class="fa fa-warning mr-1"></span>この記事は最終更新日から3年以上が経過しています。</div><section class="it-MdContent" itemprop="articleBody"><div id="item-d333bab990fc60e5e179">
<h2>
<span id="モチベーション" class="fragment"></span><a href="#%E3%83%A2%E3%83%81%E3%83%99%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3"><i class="fa fa-link"></i></a>モチベーション</h2>

<ul>
<li>
<code>sinatra</code>でtemplate engineを使いたかった</li>
<li>サイトにfooterなどを付けたかったので「コンポーネント化」的な機能が欲しかった

<ul>
<li>共通部分を独立したファイルに切り出して呼び出せること</li>
</ul>
</li>
</ul>

<h2>
<span id="結果" class="fragment"></span><a href="#%E7%B5%90%E6%9E%9C"><i class="fa fa-link"></i></a>結果</h2>

<ul>
<li>slimを使ったら満足できた。</li>
<li>hamlやerbで満足できるのかは不明。</li>
</ul>

<h2>
<span id="下調べ" class="fragment"></span><a href="#%E4%B8%8B%E8%AA%BF%E3%81%B9"><i class="fa fa-link"></i></a>下調べ</h2>

<p>Ruby系のテンプレートエンジンは3つ強いのがあるっぽい。</p>

<ul>
<li><code>erb</code></li>
<li><code>haml</code></li>
<li><code>slim</code></li>
</ul>

<p>それぞれの詳しい評価は下記リンクに詳しい。<br>
<a href="http://ruby-rails.hatenadiary.com/entry/20141001/1412169453" rel="nofollow noopener" target="_blank">Railsのテンプレートエンジンの比較 erb vs slim vs haml - Rails Webook</a></p>

<p>これを見た印象で<code>slim</code>を触ってみようかと思い、「コンポーネント化」できるか調べた。</p>

<p>機能的には<code>include</code>とかいう名前かなーと思って調べたらまさにそれがヒットした。<br>
<a href="http://blogged.e2esound.com/2014/09/17/slim-include/" rel="nofollow noopener" target="_blank">テンプレートエンジンSlim単体でファイル分割する</a></p>

<p>上記の記事で公式日本語ドキュメントにもPRがいって記載があるみたいだけど、<code>sinatra</code>に載せる例がなかったのでそこをこの記事で補足しておこうと思う。</p>

<h2>
<span id="sinatraでslimを使う" class="fragment"></span><a href="#sinatra%E3%81%A7slim%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>sinatraでslimを使う</h2>

<p>まず<code>slim</code>導入前の<code>sinatra</code>での構成はこんな感じ。<br>
今からここに<code>index</code>という名前のslimファイルを作成してGET '/'に割り当てる。</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">myproject</span></div>
<div class="highlight"><pre>app.rb
config.ru
Gemfile
</pre></div>
</div>

<p><code>slim</code>導入のために<code>Gemfile</code>に以下を追記。<br>
完了後はもちろん<code>bundle install</code>しておく。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">Gemfile</span></div>
<div class="highlight"><pre><span class="n">gem</span> <span class="s1">'slim'</span>
</pre></div>
</div>

<p><code>sinatra</code>のルーティングを管理してるクラスで<code>slim</code>メソッドで<code>:index</code>を返す。<br>
このシンボルはslimファイルの名称と一致する必要がある。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app.rb</span></div>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'sinatra'</span>
<span class="nb">require</span> <span class="s1">'slim'</span>

<span class="c1"># routing</span>
<span class="k">class</span> <span class="nc">App</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
    <span class="n">slim</span> <span class="ss">:index</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<p>slimファイル自体を<code>views/</code>配下に追加。<br>
ファイル名はシンボルと合わせる(大事なことなので<br>
今回はサンプルのため特に動的に値を割り当てることはしない。</p>

<div class="code-frame" data-lang="slim">
<div class="code-lang"><span class="bold">views/index.slim</span></div>
<div class="highlight"><pre><span class="nn">doctype</span><span class="w"> </span>html
<span class="nt">html</span>
  <span class="nt">head</span>
    <span class="nt">title</span><span class="w"> </span>Slim<span class="w"> </span>Examples
    <span class="nt">meta</span><span class="w"> </span><span class="na">name</span><span class="p">=</span><span class="s">"keywords"</span><span class="w"> </span><span class="na">content</span><span class="p">=</span><span class="s">"template language"</span>
    <span class="nt">meta</span><span class="w"> </span><span class="na">name</span><span class="p">=</span><span class="s">"author"</span><span class="w"> </span><span class="na">content</span><span class="p">=</span><span class="s">"hkdnet"</span>
  <span class="nt">body</span>
    <span class="nt">h1</span><span class="w"> </span>Markup<span class="w"> </span>examples
    <span class="nt">div</span><span class="w"> </span><span class="na">id</span><span class="p">=</span><span class="s">"footer"</span>
      <span class="p">|</span> Copyright <span class="ni">&amp;copy;</span> 2015 hkdnet
</pre></div>
</div>

<p>ここまででファイル構成は以下のようになる</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">myproject</span></div>
<div class="highlight"><pre>app.rb
config.ru
Gemfile
views
 └index.slim
</pre></div>
</div>

<p>これでいつもどおり<code>sinatra</code>を起動すれば動く<img alt=":thumbsup:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png" title=":thumbsup:" width="20"></p>

<h2>
<span id="dryな構成にする" class="fragment"></span><a href="#dry%E3%81%AA%E6%A7%8B%E6%88%90%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>DRYな構成にする</h2>

<p>コンポーネントとしてまとまっている部分を別ファイルにくくりだし、<br>
それを<code>sinatra/include</code>するようにする。</p>

<p>具体的には<code>id="footer"</code>なる要素が繰り返されそうなので、それを<code>footer.slim</code>として別ファイルに切り出す。<br>
そして<code>index.slim</code>側では<code>include footer</code>とすればそこに展開されるようにする。</p>

<p>まずはルーティング管理クラスで<code>require 'slim/include'</code>しておく。<br>
それ以外は特に不要。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app.rb</span></div>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'sinatra'</span>
<span class="nb">require</span> <span class="s1">'slim'</span>
<span class="nb">require</span> <span class="s1">'slim/include'</span> <span class="c1">#add</span>

<span class="c1"># routing</span>
<span class="k">class</span> <span class="nc">App</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
    <span class="n">slim</span> <span class="ss">:index</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<p>次に切り出したい箇所を別ファイルにする。<br>
このときネスト数は特に気にしなくてよい(と思う)<br>
というかエディタが勝手にインデント消したけど普通に動いた<img alt=":moyai:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f5ff.png" title=":moyai:" width="20"></p>

<div class="code-frame" data-lang="slim">
<div class="code-lang"><span class="bold">views/footer.slim</span></div>
<div class="highlight"><pre><span class="nt">div</span><span class="w"> </span><span class="na">id</span><span class="p">=</span><span class="s">"footer"</span>
  <span class="p">|</span> Copyright <span class="ni">&amp;copy;</span> 2015 hkdnet
</pre></div>
</div>

<p>最後にfooterを呼び出す。<br>
includeの引数にクォートをつけてはいけない。<br>
.slimはあってもなくてもよい。<br>
カレントディレクトリを基準に探査するが、引数に追加すれば変更できるようだ。</p>

<div class="code-frame" data-lang="slim">
<div class="code-lang"><span class="bold">views/index.slim</span></div>
<div class="highlight"><pre><span class="nn">doctype</span><span class="w"> </span>html
<span class="nt">html</span>
  <span class="nt">head</span>
    <span class="nt">title</span><span class="w"> </span>Slim<span class="w"> </span>Examples
    <span class="nt">meta</span><span class="w"> </span><span class="na">name</span><span class="p">=</span><span class="s">"keywords"</span><span class="w"> </span><span class="na">content</span><span class="p">=</span><span class="s">"template language"</span>
    <span class="nt">meta</span><span class="w"> </span><span class="na">name</span><span class="p">=</span><span class="s">"author"</span><span class="w"> </span><span class="na">content</span><span class="p">=</span><span class="s">"hkdnet"</span>
  <span class="nt">body</span>
    <span class="nt">h1</span><span class="w"> </span>Markup<span class="w"> </span>examples
    <span class="nt">include</span><span class="w"> </span>footer
</pre></div>
</div>

<p>これで動くようになった<img alt=":beer:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f37a.png" title=":beer:" width="20"><br>
なおこのときのフォルダ構成は以下のようになっている</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">myproject</span></div>
<div class="highlight"><pre>app.rb
config.ru
Gemfile
views
 ├footer.slim
 └index.slim
</pre></div>
</div>

<h2>
<span id="おまけ" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91"><i class="fa fa-link"></i></a>おまけ</h2>

<p>ドキュメントを読んだわけではないが、includeしたときにもrubyコードの解釈は当然実施される。</p>

<p>例えば以下の書き換えは有効である。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app.rb</span></div>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'sinatra'</span>
<span class="nb">require</span> <span class="s1">'slim'</span>
<span class="nb">require</span> <span class="s1">'slim/include'</span> <span class="c1">#add</span>

<span class="c1"># routing</span>
<span class="k">class</span> <span class="nc">App</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
    <span class="vi">@arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">slim</span> <span class="ss">:index</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<h3>
<span id="before" class="fragment"></span><a href="#before"><i class="fa fa-link"></i></a>before</h3>

<div class="code-frame" data-lang="slim">
<div class="code-lang"><span class="bold">views/index.slim</span></div>
<div class="highlight"><pre><span class="nt">ul</span><span class="nf">#numbers</span>
  <span class="p">-</span> <span class="vi">@arr</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
    <span class="nt">li</span><span class="nc">.item</span><span class="w"> </span><span class="p">=</span> <span class="n">e</span>
</pre></div>
</div>

<h3>
<span id="after" class="fragment"></span><a href="#after"><i class="fa fa-link"></i></a>after</h3>

<div class="code-frame" data-lang="slim">
<div class="code-lang"><span class="bold">views/index.slim</span></div>
<div class="highlight"><pre><span class="nt">ul</span><span class="nf">#numbers</span>
  <span class="p">-</span> <span class="vi">@arr</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
    <span class="nt">include</span><span class="w"> </span>item
</pre></div>
</div>

<div class="code-frame" data-lang="slim">
<div class="code-lang"><span class="bold">views/item.slim</span></div>
<div class="highlight"><pre><span class="nt">li</span><span class="nc">.item</span><span class="w"> </span><span class="p">=</span> <span class="n">e</span>
</pre></div>
</div>

<p>このときitem.slimでは変数eは影も形もないが<br>
index.slimで使うeを正しく参照できる。</p>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<p><a href="http://ruby-rails.hatenadiary.com/entry/20141001/1412169453" rel="nofollow noopener" target="_blank">Railsのテンプレートエンジンの比較 erb vs slim vs haml - Rails Webook</a><br>
<a href="http://blogged.e2esound.com/2014/09/17/slim-include/" rel="nofollow noopener" target="_blank">テンプレートエンジンSlim単体でファイル分割する</a></p>
</div></section><div class="it-Footer"><div class="it-Footer_actions"><div class="it-Footer_editRequest"><a class="u-link-no-underline" href="/HKDnet/items/d333bab990fc60e5e179/edit"><span class="fa fa-fw fa-send"></span><span>編集リクエスト</span></a></div><div class="it-Footer_stock"><button><span class="fa fa-folder-open"></span><span class="it-Footer_stockLabel">ストック</span></button></div><div class="it-Footer_like"><button><span class="fa fa-fw fa-thumbs-up"></span><span>いいね</span></button><a class="it-Footer_likeCount" href="/HKDnet/items/d333bab990fc60e5e179/likers">15</a></div></div><div class="it-Footer_social"><div class="it-Footer_shareButton it-Footer_shareButton-webshare"><span class="fa fa-share-alt"></span></div><div class="it-Footer_shareButton it-Footer_shareButton-twitter"><span class="fa fa-twitter"></span></div><div class="it-Footer_shareButton it-Footer_shareButton-facebook"><span class="fa fa-facebook"></span></div></div></div><div class="ai-Container" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><div class="it-User"><a href="/HKDnet"><img class="ai-User_image" itemprop="image" alt="HKDnet" src="https://qiita-image-store.s3.amazonaws.com/0/48144/profile-images/1473691245" /></a><div class="ai-User_body"><div class="ai-User_header"><a class="ai-User_name" href="/HKDnet">@はくどー</a><a class="ai-User_urlname" itemprop="name" href="/HKDnet">HKDnet</a></div><div class="ai-User_description"></div></div></div></div></div></div><div class="p-items_options"></div><div class="p-items_toc"><div class="it-Toc"><div class="it-Toc_nav"><ul>
<li>
<a href="#%E3%83%A2%E3%83%81%E3%83%99%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3">モチベーション</a>
</li>
<li>
<a href="#%E7%B5%90%E6%9E%9C">結果</a>
</li>
<li>
<a href="#%E4%B8%8B%E8%AA%BF%E3%81%B9">下調べ</a>
</li>
<li>
<a href="#sinatra%E3%81%A7slim%E3%82%92%E4%BD%BF%E3%81%86">sinatraでslimを使う</a>
</li>
<li>
<a href="#dry%E3%81%AA%E6%A7%8B%E6%88%90%E3%81%AB%E3%81%99%E3%82%8B">DRYな構成にする</a>
</li>
<li>
<a href="#%E3%81%8A%E3%81%BE%E3%81%91">おまけ</a>
<ul>
<li>
<a href="#before">before</a>
</li>
<li>
<a href="#after">after</a>
</li>
</ul>
</li>
<li>
<a href="#%E5%8F%82%E8%80%83">参考</a>
</li>
</ul>
</div></div></div></div></div><div class="p-items_wrapper p-items_wrapper-white"><div class="p-items_container"><div class="p-items_leftDummy"></div><div class="p-items_main"></div><div class="p-items_rightDummy"></div></div></div></article></div><footer id="globalFooter" class="st-Footer px-2 px-1@s pt-1 pt-3@s pb-2"><div class="st-Footer_container"><ul class="st-Footer_start"><li class="st-Footer_link"><a class="st-Footer_copyright" href="https://increments.co.jp">© 2011-2018 Increments Inc.</a></li><li class="st-Footer_link"><a href="/terms">利用規約</a></li><li class="st-Footer_link"><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">ガイドライン</a></li><li class="st-Footer_link"><a href="/privacy">プライバシー</a></li><li class="st-Footer_link"><a href="https://help.qiita.com">ヘルプ</a></li></ul><ul class="st-Footer_end"><li class="st-Footer_link"><a href="/about">Qiita とは</a></li><li class="st-Footer_link"><a href="/users">ユーザー</a></li><li class="st-Footer_link"><a href="/tags">タグ</a></li><li class="st-Footer_link"><a href="/items">投稿</a></li><li class="st-Footer_link"><a href="https://blog.qiita.com">ブログ</a></li><li class="st-Footer_link"><a href="/api/v2/docs">API</a></li><li class="st-Footer_link"><a href="https://teams.qiita.com">Qiita:Team</a></li><li class="st-Footer_link"><a href="/feedback/new">ご意見</a></li></ul></div></footer></div><div class="p-messages"><div data-hyperapp-app="Message" data-hyperapp-props="{&quot;messages&quot;:[]}"></div></div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;mixpanelToken&quot;:&quot;17d24b448ca579c365d2d1057f3a1791&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;DY9gQbObCkVgOux2QaXXoJCiLqX7+VYPSWMazAlZNWk3uHV2fPjV0AIxN2banx9AcrApcsNAUmyvJeviDDRZNA==&quot;,&quot;locale&quot;:&quot;ja&quot;},&quot;currentUser&quot;:null}" /><script>/* <![CDATA[ */
var yahoo_retargeting_id = '6B63B2EQA6';
var yahoo_retargeting_label = 'qiita';
var yahoo_retargeting_page_type = '';
var yahoo_retargeting_items = [{item_id: '', category_id: '', price: '', quantity: ''}];
/* ]]> */</script><script language="javascript" src="https://b92.yahoo.co.jp/js/s_retargeting.js" type="text/javascript"></script><script src="//platform.twitter.com/oct.js" type="text/javascript"></script><script>twttr.conversion.trackPid('nzz0o', { tw_sale_amount: 0, tw_order_quantity: 0 });</script><noscript><img alt="" height="1" src="https://analytics.twitter.com/i/adsct?txn_id=nzz0o&amp;p_id=Twitter&amp;tw_sale_amount=0&amp;tw_order_quantity=0" style="display:none;" width="1" /><img alt="" height="1" src="//t.co/i/adsct?txn_id=nzz0o&amp;p_id=Twitter&amp;tw_sale_amount=0&amp;tw_order_quantity=0" style="display:none;" width="1" /></noscript></body></html>